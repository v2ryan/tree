<!DOCTYPE html>

<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FlashForge â€” NotebookLM CSV â†’ é–ƒå¡ & PDF</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Noto+Sans+TC:wght@400;500;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
:root {
  --ink: #1a1a2e;
  --ink-50: rgba(26,26,46,0.5);
  --ink-20: rgba(26,26,46,0.2);
  --ink-08: rgba(26,26,46,0.08);
  --ink-04: rgba(26,26,46,0.04);
  --paper: #faf9f6;
  --paper-warm: #f5f0e8;
  --white: #ffffff;
  --accent: #e85d26;
  --accent-light: #fff0eb;
  --accent-dark: #c44a1a;
  --mint: #2a9d8f;
  --mint-light: #e8f6f4;
  --blue: #457b9d;
  --blue-light: #eaf2f7;
  --gold: #e9c46a;
  --gold-light: #fdf8eb;
  --radius: 12px;
  --radius-lg: 20px;
  --shadow-sm: 0 1px 3px rgba(26,26,46,0.06);
  --shadow-md: 0 4px 16px rgba(26,26,46,0.08);
  --shadow-lg: 0 8px 32px rgba(26,26,46,0.12);
  --shadow-xl: 0 16px 48px rgba(26,26,46,0.16);
  --font-body: 'DM Sans', 'Noto Sans TC', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: var(â€“font-body);
background: var(â€“paper);
color: var(â€“ink);
line-height: 1.6;
min-height: 100vh;
-webkit-font-smoothing: antialiased;
}

/* ========== HEADER ========== */
header {
background: var(â€“ink);
color: var(â€“paper);
padding: 0;
position: sticky;
top: 0;
z-index: 100;
box-shadow: var(â€“shadow-lg);
}

.header-inner {
max-width: 1200px;
margin: 0 auto;
padding: 16px 24px;
display: flex;
align-items: center;
justify-content: space-between;
gap: 16px;
}

.logo {
display: flex;
align-items: center;
gap: 12px;
}

.logo-icon {
width: 40px;
height: 40px;
background: var(â€“accent);
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
transform: rotate(-3deg);
flex-shrink: 0;
}

.logo h1 {
font-size: 20px;
font-weight: 700;
letter-spacing: -0.5px;
}

.logo h1 span {
color: var(â€“accent);
}

.header-tag {
font-size: 11px;
font-family: var(â€“font-mono);
background: rgba(255,255,255,0.1);
padding: 4px 10px;
border-radius: 20px;
color: rgba(255,255,255,0.6);
}

/* ========== MAIN ========== */
main {
max-width: 1200px;
margin: 0 auto;
padding: 32px 24px 80px;
}

/* ========== UPLOAD ZONE ========== */
.upload-section {
margin-bottom: 32px;
}

.upload-zone {
border: 2px dashed var(â€“ink-20);
border-radius: var(â€“radius-lg);
padding: 48px 32px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
background: var(â€“white);
position: relative;
overflow: hidden;
}

.upload-zone::before {
content: â€˜â€™;
position: absolute;
inset: 0;
background: repeating-linear-gradient(
-45deg,
transparent,
transparent 8px,
var(â€“ink-04) 8px,
var(â€“ink-04) 9px
);
opacity: 0;
transition: opacity 0.3s;
}

.upload-zone:hover,
.upload-zone.dragover {
border-color: var(â€“accent);
background: var(â€“accent-light);
transform: scale(1.005);
}

.upload-zone:hover::before,
.upload-zone.dragover::before {
opacity: 1;
}

.upload-zone.has-file {
border-style: solid;
border-color: var(â€“mint);
background: var(â€“mint-light);
padding: 24px 32px;
}

.upload-icon {
font-size: 48px;
margin-bottom: 16px;
display: block;
position: relative;
z-index: 1;
}

.upload-zone h2 {
font-size: 18px;
font-weight: 700;
margin-bottom: 8px;
position: relative;
z-index: 1;
}

.upload-zone p {
color: var(â€“ink-50);
font-size: 14px;
position: relative;
z-index: 1;
}

.upload-zone input[type=â€œfileâ€] {
display: none;
}

.file-info {
display: flex;
align-items: center;
justify-content: center;
gap: 12px;
position: relative;
z-index: 1;
}

.file-info .file-name {
font-weight: 600;
font-family: var(â€“font-mono);
font-size: 14px;
}

.file-info .file-stats {
color: var(â€“ink-50);
font-size: 13px;
}

.btn-remove {
background: none;
border: 1px solid var(â€“ink-20);
border-radius: 8px;
padding: 4px 12px;
font-size: 12px;
cursor: pointer;
color: var(â€“ink-50);
transition: all 0.2s;
}

.btn-remove:hover {
background: #fee;
border-color: #e55;
color: #c33;
}

/* ========== COLUMN MAPPING ========== */
.mapping-section {
background: var(â€“white);
border-radius: var(â€“radius-lg);
padding: 24px;
margin-bottom: 32px;
box-shadow: var(â€“shadow-sm);
display: none;
}

.mapping-section.active { display: block; }

.mapping-section h3 {
font-size: 16px;
font-weight: 700;
margin-bottom: 16px;
display: flex;
align-items: center;
gap: 8px;
}

.mapping-row {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 16px;
margin-bottom: 16px;
}

@media (max-width: 640px) {
.mapping-row { grid-template-columns: 1fr; }
}

.mapping-group label {
display: block;
font-size: 12px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
color: var(â€“ink-50);
margin-bottom: 6px;
}

.mapping-group select {
width: 100%;
padding: 10px 14px;
border: 1px solid var(â€“ink-20);
border-radius: var(â€“radius);
font-family: var(â€“font-body);
font-size: 14px;
background: var(â€“paper);
cursor: pointer;
transition: border-color 0.2s;
appearance: auto;
}

.mapping-group select:focus {
outline: none;
border-color: var(â€“accent);
}

/* ========== TOOLBAR ========== */
.toolbar {
display: flex;
align-items: center;
justify-content: space-between;
flex-wrap: wrap;
gap: 12px;
margin-bottom: 24px;
display: none;
}

.toolbar.active { display: flex; }

.toolbar-left {
display: flex;
align-items: center;
gap: 8px;
flex-wrap: wrap;
}

.toolbar-right {
display: flex;
align-items: center;
gap: 8px;
}

.btn {
display: inline-flex;
align-items: center;
gap: 6px;
padding: 10px 18px;
border: none;
border-radius: var(â€“radius);
font-family: var(â€“font-body);
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
white-space: nowrap;
}

.btn-primary {
background: var(â€“accent);
color: white;
}

.btn-primary:hover {
background: var(â€“accent-dark);
transform: translateY(-1px);
box-shadow: var(â€“shadow-md);
}

.btn-secondary {
background: var(â€“white);
color: var(â€“ink);
border: 1px solid var(â€“ink-20);
}

.btn-secondary:hover {
background: var(â€“paper);
border-color: var(â€“ink-50);
}

.btn-secondary.active {
background: var(â€“ink);
color: var(â€“paper);
border-color: var(â€“ink);
}

.btn-mint {
background: var(â€“mint);
color: white;
}

.btn-mint:hover {
background: #238b7f;
transform: translateY(-1px);
box-shadow: var(â€“shadow-md);
}

.layout-btns {
display: flex;
border: 1px solid var(â€“ink-20);
border-radius: var(â€“radius);
overflow: hidden;
}

.layout-btns .btn-layout {
padding: 8px 14px;
border: none;
background: var(â€“white);
cursor: pointer;
font-size: 13px;
font-weight: 600;
font-family: var(â€“font-body);
color: var(â€“ink-50);
transition: all 0.2s;
}

.layout-btns .btn-layout + .btn-layout {
border-left: 1px solid var(â€“ink-20);
}

.layout-btns .btn-layout.active {
background: var(â€“ink);
color: var(â€“paper);
}

.card-size-select {
padding: 8px 12px;
border: 1px solid var(â€“ink-20);
border-radius: var(â€“radius);
font-family: var(â€“font-body);
font-size: 13px;
background: var(â€“white);
cursor: pointer;
}

/* ========== FLASHCARD GRID ========== */
.cards-container {
display: none;
}

.cards-container.active { display: block; }

.cards-grid {
display: grid;
gap: 20px;
}

.cards-grid.layout-2 { grid-template-columns: repeat(2, 1fr); }
.cards-grid.layout-3 { grid-template-columns: repeat(3, 1fr); }
.cards-grid.layout-4 { grid-template-columns: repeat(4, 1fr); }
.cards-grid.layout-list { grid-template-columns: 1fr; }

@media (max-width: 900px) {
.cards-grid.layout-3,
.cards-grid.layout-4 { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 600px) {
.cards-grid.layout-2,
.cards-grid.layout-3,
.cards-grid.layout-4 { grid-template-columns: 1fr; }
}

/* ========== FLASHCARD ========== */
.flashcard {
background: var(â€“white);
border-radius: var(â€“radius);
box-shadow: var(â€“shadow-sm);
overflow: hidden;
transition: all 0.25s ease;
border: 1px solid var(â€“ink-08);
position: relative;
}

.flashcard:hover {
box-shadow: var(â€“shadow-md);
transform: translateY(-2px);
}

.flashcard-num {
position: absolute;
top: 10px;
right: 12px;
font-size: 11px;
font-family: var(â€“font-mono);
color: var(â€“ink-20);
font-weight: 500;
}

.flashcard-front {
padding: 20px 20px 16px;
border-bottom: 2px dashed var(â€“ink-08);
min-height: 80px;
position: relative;
}

.flashcard-front::before {
content: â€˜Qâ€™;
position: absolute;
top: 10px;
left: 12px;
font-size: 11px;
font-weight: 700;
color: var(â€“accent);
font-family: var(â€“font-mono);
background: var(â€“accent-light);
width: 22px;
height: 22px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 6px;
}

.flashcard-front .content {
padding-left: 28px;
font-weight: 600;
font-size: 14px;
line-height: 1.6;
}

.flashcard-back {
padding: 16px 20px 20px;
background: var(â€“ink-04);
min-height: 80px;
position: relative;
}

.flashcard-back::before {
content: â€˜Aâ€™;
position: absolute;
top: 12px;
left: 12px;
font-size: 11px;
font-weight: 700;
color: var(â€“mint);
font-family: var(â€“font-mono);
background: var(â€“mint-light);
width: 22px;
height: 22px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 6px;
}

.flashcard-back .content {
padding-left: 28px;
font-size: 13px;
line-height: 1.7;
color: var(â€“ink-50);
}

.flashcard-tag {
margin-top: 10px;
padding-left: 28px;
}

.flashcard-tag span {
display: inline-block;
font-size: 11px;
font-family: var(â€“font-mono);
background: var(â€“blue-light);
color: var(â€“blue);
padding: 2px 8px;
border-radius: 4px;
font-weight: 500;
}

/* ========== LIST VIEW ========== */
.layout-list .flashcard {
display: grid;
grid-template-columns: 1fr 1fr;
}

.layout-list .flashcard-front {
border-bottom: none;
border-right: 2px dashed var(â€“ink-08);
}

@media (max-width: 600px) {
.layout-list .flashcard {
grid-template-columns: 1fr;
}
.layout-list .flashcard-front {
border-right: none;
border-bottom: 2px dashed var(â€“ink-08);
}
}

/* ========== STATS BAR ========== */
.stats-bar {
display: flex;
gap: 24px;
margin-bottom: 24px;
padding: 16px 20px;
background: var(â€“white);
border-radius: var(â€“radius);
box-shadow: var(â€“shadow-sm);
display: none;
}

.stats-bar.active { display: flex; }

.stat-item {
display: flex;
align-items: center;
gap: 8px;
}

.stat-num {
font-size: 24px;
font-weight: 700;
font-family: var(â€“font-mono);
color: var(â€“accent);
}

.stat-label {
font-size: 12px;
color: var(â€“ink-50);
font-weight: 500;
}

/* ========== EMPTY STATE ========== */
.empty-state {
text-align: center;
padding: 80px 24px;
color: var(â€“ink-50);
}

.empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
.empty-state h3 { font-size: 18px; margin-bottom: 8px; color: var(â€“ink); }
.empty-state p { font-size: 14px; max-width: 400px; margin: 0 auto; }

/* ========== SAMPLE DATA ========== */
.sample-section {
margin-top: 24px;
padding: 20px;
background: var(â€“gold-light);
border-radius: var(â€“radius);
border: 1px solid var(â€“gold);
}

.sample-section h4 {
font-size: 14px;
margin-bottom: 8px;
display: flex;
align-items: center;
gap: 6px;
}

.sample-section p {
font-size: 13px;
color: var(â€“ink-50);
margin-bottom: 12px;
}

.sample-section pre {
background: var(â€“white);
padding: 12px 16px;
border-radius: 8px;
font-family: var(â€“font-mono);
font-size: 12px;
line-height: 1.8;
overflow-x: auto;
border: 1px solid var(â€“ink-08);
margin-bottom: 12px;
}

/* ========== PRINT STYLES ========== */
@media print {
@page {
size: A4;
margin: 12mm;
}

body {
background: white !important;
-webkit-print-color-adjust: exact;
print-color-adjust: exact;
}

header, .upload-section, .mapping-section,
.toolbar, .stats-bar, .sample-section,
.btn-remove, .no-print {
display: none !important;
}

main {
padding: 0 !important;
max-width: 100% !important;
}

.cards-container { display: block !important; }

.cards-grid {
gap: 8px !important;
}

.cards-grid.layout-2 { grid-template-columns: repeat(2, 1fr) !important; }
.cards-grid.layout-3 { grid-template-columns: repeat(3, 1fr) !important; }
.cards-grid.layout-4 { grid-template-columns: repeat(4, 1fr) !important; }
.cards-grid.layout-list { grid-template-columns: 1fr !important; }

.flashcard {
break-inside: avoid;
page-break-inside: avoid;
box-shadow: none !important;
border: 1px solid #ccc !important;
transform: none !important;
}

.flashcard:hover {
box-shadow: none !important;
transform: none !important;
}

.flashcard-front { min-height: auto; padding: 12px 14px 10px; }
.flashcard-back { min-height: auto; padding: 10px 14px 12px; }
.flashcard-front .content, .flashcard-back .content { font-size: 12px; }
.flashcard-front::before, .flashcard-back::before { font-size: 9px; width: 18px; height: 18px; }
.flashcard-num { font-size: 9px; }

.print-header {
display: block !important;
text-align: center;
padding: 8px 0 16px;
border-bottom: 2px solid #333;
margin-bottom: 16px;
}

.print-header h2 { font-size: 16px; }
.print-header p { font-size: 11px; color: #666; }
}

.print-header { display: none; }

/* ========== ANIMATIONS ========== */
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(12px); }
to { opacity: 1; transform: translateY(0); }
}

.flashcard {
animation: fadeInUp 0.3s ease both;
}

.flashcard:nth-child(2) { animation-delay: 0.03s; }
.flashcard:nth-child(3) { animation-delay: 0.06s; }
.flashcard:nth-child(4) { animation-delay: 0.09s; }
.flashcard:nth-child(5) { animation-delay: 0.12s; }
.flashcard:nth-child(6) { animation-delay: 0.15s; }

/* ========== FOOTER ========== */
footer {
text-align: center;
padding: 24px;
color: var(â€“ink-20);
font-size: 12px;
font-family: var(â€“font-mono);
}
</style>

</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">ğŸƒ</div>
      <h1>Flash<span>Forge</span></h1>
    </div>
    <div class="header-tag">NotebookLM CSV â†’ é–ƒå¡ & PDF</div>
  </div>
</header>

<main>
  <!-- Upload -->
  <div class="upload-section">
    <div class="upload-zone" id="uploadZone">
      <span class="upload-icon">ğŸ“„</span>
      <h2>æ‹–æ”¾ CSV æª”æ¡ˆåˆ°æ­¤è™•</h2>
      <p>æˆ–é»æ“Šæ­¤è™•é¸æ“‡æª”æ¡ˆ â€” æ”¯æ´ NotebookLM åŒ¯å‡ºå˜… CSV æ ¼å¼</p>
      <input type="file" id="fileInput" accept=".csv,.tsv,.txt">
    </div>

```
<div class="sample-section no-print">
  <h4>ğŸ’¡ æ”¯æ´å˜… CSV æ ¼å¼</h4>
  <p>ç³»çµ±æœƒè‡ªå‹•åµæ¸¬æ¬„ä½åç¨±ï¼Œä»¥ä¸‹ä¿‚å¸¸è¦‹æ ¼å¼ï¼š</p>
  <pre>Front,Back
```

ä»€éº¼æ˜¯å…‰åˆä½œç”¨ï¼Ÿ,æ¤ç‰©åˆ©ç”¨é™½å…‰ã€æ°´å’ŒäºŒæ°§åŒ–ç¢³è£½é€ é¤Šåˆ†çš„éç¨‹
What is photosynthesis?,The process by which plants convert sunlight into energy</pre>
<p>äº¦æ”¯æ´ï¼š<code>Question/Answer</code>ã€<code>Term/Definition</code>ã€<code>é¡Œç›®/ç­”æ¡ˆ</code>ã€<code>å•é¡Œ/è§£ç­”</code> ç­‰æ¬„ä½å</p>
<button class="btn btn-secondary" onclick="loadSampleData()">ğŸ“‹ è¼‰å…¥ç¤ºç¯„è³‡æ–™è©¦è©¦</button>
</div>

  </div>

  <!-- Column Mapping -->

  <div class="mapping-section" id="mappingSection">
    <h3>ğŸ”— æ¬„ä½å°æ‡‰</h3>
    <div class="mapping-row">
      <div class="mapping-group">
        <label>æ­£é¢ (å•é¡Œ)</label>
        <select id="mapFront"></select>
      </div>
      <div class="mapping-group">
        <label>èƒŒé¢ (ç­”æ¡ˆ)</label>
        <select id="mapBack"></select>
      </div>
      <div class="mapping-group">
        <label>åˆ†é¡æ¨™ç±¤ (é¸å¡«)</label>
        <select id="mapTag"></select>
      </div>
    </div>
    <button class="btn btn-primary" onclick="applyMapping()">âœ… ç¢ºèªä¸¦ç”Ÿæˆé–ƒå¡</button>
  </div>

  <!-- Toolbar -->

  <div class="toolbar" id="toolbar">
    <div class="toolbar-left">
      <div class="layout-btns">
        <button class="btn-layout active" data-cols="2" onclick="setLayout(2, this)">2 æ¬„</button>
        <button class="btn-layout" data-cols="3" onclick="setLayout(3, this)">3 æ¬„</button>
        <button class="btn-layout" data-cols="4" onclick="setLayout(4, this)">4 æ¬„</button>
        <button class="btn-layout" data-cols="list" onclick="setLayout('list', this)">åˆ—è¡¨</button>
      </div>
      <select class="card-size-select" id="fontSizeSelect" onchange="setFontSize(this.value)">
        <option value="small">å­—é«”ï¼šå°</option>
        <option value="medium" selected>å­—é«”ï¼šä¸­</option>
        <option value="large">å­—é«”ï¼šå¤§</option>
      </select>
    </div>
    <div class="toolbar-right">
      <button class="btn btn-secondary" onclick="toggleAnswers()">ğŸ‘ é¡¯ç¤º/éš±è—ç­”æ¡ˆ</button>
      <button class="btn btn-mint" onclick="window.print()">ğŸ–¨ åˆ—å° / å„²å­˜ PDF</button>
    </div>
  </div>

  <!-- Stats -->

  <div class="stats-bar" id="statsBar">
    <div class="stat-item">
      <div class="stat-num" id="statTotal">0</div>
      <div class="stat-label">å¼µé–ƒå¡</div>
    </div>
    <div class="stat-item">
      <div class="stat-num" id="statTags">0</div>
      <div class="stat-label">å€‹åˆ†é¡</div>
    </div>
  </div>

  <!-- Cards -->

  <div class="cards-container" id="cardsContainer">
    <div class="print-header">
      <h2 id="printTitle">FlashForge é–ƒå¡</h2>
      <p id="printMeta"></p>
    </div>
    <div class="cards-grid layout-2" id="cardsGrid"></div>
  </div>

  <!-- Empty state -->

  <div class="empty-state" id="emptyState">
    <div class="icon">ğŸƒ</div>
    <h3>ä¸Šå‚³ CSV é–‹å§‹è£½ä½œé–ƒå¡</h3>
    <p>å°‡ NotebookLM åŒ¯å‡ºå˜… CSV æ‹–æ”¾åˆ°ä¸Šæ–¹ï¼Œå³å¯ç”Ÿæˆå¯æ‰“å°å˜…é–ƒå¡</p>
  </div>
</main>

<footer>
  FlashForge &mdash; Built for learning ğŸ“š
</footer>

<script>
// ========== STATE ==========
let csvData = [];
let csvHeaders = [];
let cards = [];
let answersVisible = true;
let currentLayout = 2;

// ========== UPLOAD ==========
const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');

uploadZone.addEventListener('click', () => fileInput.click());
uploadZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadZone.classList.add('dragover');
});
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', (e) => {
  if (e.target.files.length) handleFile(e.target.files[0]);
});

function handleFile(file) {
  if (!file.name.match(/\.(csv|tsv|txt)$/i)) {
    alert('è«‹ä¸Šå‚³ CSVã€TSV æˆ– TXT æª”æ¡ˆ');
    return;
  }

  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    encoding: 'UTF-8',
    complete: (results) => {
      if (results.data.length === 0) {
        alert('æª”æ¡ˆç„¡è³‡æ–™ï¼Œè«‹æª¢æŸ¥æ ¼å¼');
        return;
      }
      csvData = results.data;
      csvHeaders = results.meta.fields || [];

      // Update upload zone
      uploadZone.classList.add('has-file');
      uploadZone.innerHTML = `
        <div class="file-info">
          <span style="font-size:24px">âœ…</span>
          <span class="file-name">${file.name}</span>
          <span class="file-stats">${csvData.length} è¡Œ Â· ${csvHeaders.length} æ¬„</span>
          <button class="btn-remove" onclick="resetAll(event)">âœ• ç§»é™¤</button>
        </div>
      `;

      showMapping();
    },
    error: (err) => {
      alert('è§£æå¤±æ•—: ' + err.message);
    }
  });
}

// ========== COLUMN MAPPING ==========
const frontKeywords = ['front', 'question', 'q', 'term', 'word', 'prompt', 'å•é¡Œ', 'é¡Œç›®', 'æ­£é¢', 'è©èª', 'å­—è©', 'å‰é¢', 'æ¦‚å¿µ'];
const backKeywords = ['back', 'answer', 'a', 'definition', 'response', 'explanation', 'ç­”æ¡ˆ', 'è§£ç­”', 'èƒŒé¢', 'å®šç¾©', 'é‡‹ç¾©', 'è§£é‡‹', 'å¾Œé¢'];
const tagKeywords = ['tag', 'category', 'topic', 'chapter', 'type', 'group', 'åˆ†é¡', 'æ¨™ç±¤', 'ä¸»é¡Œ', 'ç« ç¯€', 'é¡åˆ¥'];

function autoDetectColumn(keywords) {
  for (const kw of keywords) {
    const found = csvHeaders.find(h => h.toLowerCase().trim() === kw);
    if (found) return found;
  }
  for (const kw of keywords) {
    const found = csvHeaders.find(h => h.toLowerCase().includes(kw));
    if (found) return found;
  }
  return null;
}

function showMapping() {
  const section = document.getElementById('mappingSection');
  section.classList.add('active');

  const frontSel = document.getElementById('mapFront');
  const backSel = document.getElementById('mapBack');
  const tagSel = document.getElementById('mapTag');

  const optionsHtml = csvHeaders.map(h => `<option value="${h}">${h}</option>`).join('');
  frontSel.innerHTML = optionsHtml;
  backSel.innerHTML = optionsHtml;
  tagSel.innerHTML = `<option value="">â€” ç„¡ â€”</option>` + optionsHtml;

  // Auto-detect
  const detectedFront = autoDetectColumn(frontKeywords);
  const detectedBack = autoDetectColumn(backKeywords);
  const detectedTag = autoDetectColumn(tagKeywords);

  if (detectedFront) frontSel.value = detectedFront;
  else if (csvHeaders.length >= 1) frontSel.value = csvHeaders[0];

  if (detectedBack) backSel.value = detectedBack;
  else if (csvHeaders.length >= 2) backSel.value = csvHeaders[1];

  if (detectedTag) tagSel.value = detectedTag;

  // If clearly only 2 useful columns, auto-generate
  if (csvHeaders.length <= 3 && detectedFront && detectedBack) {
    applyMapping();
  }
}

function applyMapping() {
  const frontCol = document.getElementById('mapFront').value;
  const backCol = document.getElementById('mapBack').value;
  const tagCol = document.getElementById('mapTag').value;

  if (frontCol === backCol) {
    alert('æ­£é¢åŒèƒŒé¢å””å¯ä»¥ç”¨åŒä¸€æ¬„');
    return;
  }

  cards = csvData
    .filter(row => (row[frontCol] || '').trim() || (row[backCol] || '').trim())
    .map((row, i) => ({
      num: i + 1,
      front: (row[frontCol] || '').trim(),
      back: (row[backCol] || '').trim(),
      tag: tagCol ? (row[tagCol] || '').trim() : ''
    }));

  if (cards.length === 0) {
    alert('æµå””åˆ°æœ‰æ•ˆè³‡æ–™ï¼Œè«‹æª¢æŸ¥æ¬„ä½å°æ‡‰');
    return;
  }

  renderCards();
  document.getElementById('mappingSection').classList.remove('active');
}

// ========== RENDER CARDS ==========
function renderCards() {
  const grid = document.getElementById('cardsGrid');
  const tags = [...new Set(cards.map(c => c.tag).filter(Boolean))];

  grid.innerHTML = cards.map(c => `
    <div class="flashcard">
      <div class="flashcard-num">#${c.num}</div>
      <div class="flashcard-front">
        <div class="content">${escHtml(c.front)}</div>
      </div>
      <div class="flashcard-back answer-area">
        <div class="content">${escHtml(c.back)}</div>
        ${c.tag ? `<div class="flashcard-tag"><span>${escHtml(c.tag)}</span></div>` : ''}
      </div>
    </div>
  `).join('');

  // Update UI
  document.getElementById('cardsContainer').classList.add('active');
  document.getElementById('toolbar').classList.add('active');
  document.getElementById('statsBar').classList.add('active');
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('statTotal').textContent = cards.length;
  document.getElementById('statTags').textContent = tags.length;
  document.getElementById('printMeta').textContent = `å…± ${cards.length} å¼µé–ƒå¡ Â· ${new Date().toLocaleDateString('zh-HK')}`;

  answersVisible = true;
}

function escHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

// ========== LAYOUT ==========
function setLayout(cols, btn) {
  const grid = document.getElementById('cardsGrid');
  grid.className = 'cards-grid';

  if (cols === 'list') {
    grid.classList.add('layout-list');
  } else {
    grid.classList.add(`layout-${cols}`);
  }

  currentLayout = cols;
  document.querySelectorAll('.btn-layout').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function setFontSize(size) {
  const grid = document.getElementById('cardsGrid');
  const map = { small: '12px', medium: '14px', large: '16px' };
  const mapBack = { small: '11px', medium: '13px', large: '15px' };
  grid.querySelectorAll('.flashcard-front .content').forEach(el => el.style.fontSize = map[size]);
  grid.querySelectorAll('.flashcard-back .content').forEach(el => el.style.fontSize = mapBack[size]);
}

function toggleAnswers() {
  answersVisible = !answersVisible;
  document.querySelectorAll('.answer-area').forEach(el => {
    el.style.display = answersVisible ? '' : 'none';
  });
}

// ========== SAMPLE DATA ==========
function loadSampleData() {
  const sampleCSV = `Front,Back,Tag
ä»€éº¼æ˜¯å…‰åˆä½œç”¨ï¼Ÿ,æ¤ç‰©åˆ©ç”¨é™½å…‰ã€æ°´å’ŒäºŒæ°§åŒ–ç¢³ï¼Œè£½é€ è‘¡è„ç³–å’Œæ°§æ°£çš„éç¨‹ã€‚,ç”Ÿç‰©
What is the water cycle?,The continuous movement of water between Earth's surface and atmosphere through evaporation condensation and precipitation.,Science
åœ°çƒè‡ªè½‰ä¸€åœˆéœ€è¦å¤šä¹…ï¼Ÿ,ç´„ 24 å°æ™‚ï¼ˆä¸€å¤©ï¼‰ã€‚,å¤©æ–‡
What are the three states of matter?,Solid liquid and gas. Matter can change between states by adding or removing heat.,Science
ä»€éº¼æ˜¯é£Ÿç‰©éˆï¼Ÿ,ç”Ÿç‰©ä¹‹é–“é€éé£Ÿç‰©å½¢æˆçš„èƒ½é‡å‚³éé—œä¿‚ï¼Œç”±ç”Ÿç”¢è€…åˆ°æ¶ˆè²»è€…å†åˆ°åˆ†è§£è€…ã€‚,ç”Ÿç‰©
How do magnets work?,Magnets have a north and south pole. Opposite poles attract and same poles repel each other.,Physics
é¦™æ¸¯çš„å®˜æ–¹èªè¨€æ˜¯ä»€éº¼ï¼Ÿ,ä¸­æ–‡å’Œè‹±æ–‡ã€‚,å¸¸è­˜
What is gravity?,A force that pulls objects toward each other. Earth's gravity keeps us on the ground.,Physics`;

  const parsed = Papa.parse(sampleCSV, { header: true, skipEmptyLines: true });
  csvData = parsed.data;
  csvHeaders = parsed.meta.fields;

  uploadZone.classList.add('has-file');
  uploadZone.innerHTML = `
    <div class="file-info">
      <span style="font-size:24px">ğŸ“‹</span>
      <span class="file-name">ç¤ºç¯„è³‡æ–™</span>
      <span class="file-stats">${csvData.length} è¡Œ Â· ${csvHeaders.length} æ¬„</span>
      <button class="btn-remove" onclick="resetAll(event)">âœ• ç§»é™¤</button>
    </div>
  `;

  showMapping();
}

// ========== RESET ==========
function resetAll(e) {
  if (e) e.stopPropagation();
  csvData = [];
  csvHeaders = [];
  cards = [];
  fileInput.value = '';

  uploadZone.classList.remove('has-file');
  uploadZone.innerHTML = `
    <span class="upload-icon">ğŸ“„</span>
    <h2>æ‹–æ”¾ CSV æª”æ¡ˆåˆ°æ­¤è™•</h2>
    <p>æˆ–é»æ“Šæ­¤è™•é¸æ“‡æª”æ¡ˆ â€” æ”¯æ´ NotebookLM åŒ¯å‡ºå˜… CSV æ ¼å¼</p>
    <input type="file" id="fileInput" accept=".csv,.tsv,.txt">
  `;

  // Re-bind file input
  document.getElementById('fileInput').addEventListener('change', (e) => {
    if (e.target.files.length) handleFile(e.target.files[0]);
  });

  document.getElementById('mappingSection').classList.remove('active');
  document.getElementById('toolbar').classList.remove('active');
  document.getElementById('statsBar').classList.remove('active');
  document.getElementById('cardsContainer').classList.remove('active');
  document.getElementById('cardsGrid').innerHTML = '';
  document.getElementById('emptyState').style.display = '';
}
</script>

</body>
</html>